name: æ„å»ºå’Œéƒ¨ç½²

on:
  push:
    branches:
      - dev3
      
permissions:
    contents: write
      
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸš€ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ğŸ—ï¸ å®‰è£… Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: ğŸ“¦ å®‰è£… yarn
      run: npm install -g yarn

    - name: ğŸ“¦ åˆ—å‡ºnodeç‰ˆæœ¬
      run: |
        pwd
        node -v

    - name: ğŸ“¦ åˆ—å‡ºnpmç‰ˆæœ¬
      run: npm -v

    - name: ğŸ“¦ åˆ—å‡ºyarnç‰ˆæœ¬
      run: yarn -v

    - name: ğŸ”§ å®‰è£…ä¾èµ–
      run: yarn install

    - name: ğŸ› ï¸ æ„å»ºé¡¹ç›®
      run: yarn build

    - name: ğŸ“‚ åˆ›å»ºä¸´æ—¶ç›®å½•
      run: mkdir ./../temp_dist/

    - name: ğŸ“„ åˆ—å‡ºå½“å‰ç›®å½•æ–‡ä»¶
      run: ls -l

    - name: ğŸšš ç§»åŠ¨æ„å»ºæ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•
      run: mv ./dist/* ../temp_dist/

    - name: ğŸ› ï¸ é…ç½®Gitç”¨æˆ·ä¿¡æ¯
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'

    - name: ğŸ”„ è·å–æœ€æ–°ä»£ç 
      run: git fetch

    - name: ğŸ”€ åˆ‡æ¢åˆ°main3åˆ†æ”¯
      run: git checkout main3

    - name: ğŸ”„ æ‹‰å–main3åˆ†æ”¯æœ€æ–°ä»£ç 
      run: git pull origin main3

    - name: ğŸ“„ åˆ—å‡ºmain3åˆ†æ”¯æ–‡ä»¶
      run: ls -l

    - name: ğŸ§¹ æ¸…ç†å½“å‰ç›®å½•ï¼ˆä¿ç•™.gitï¼‰
      run: find . -mindepth 1 -maxdepth 1 ! -name '.git' -exec rm -rf {} +

    - name: ğŸšš ä»ä¸´æ—¶ç›®å½•ç§»åŠ¨æ–‡ä»¶åˆ°å½“å‰ç›®å½•
      run: mv ./../temp_dist/* ./

    - name: ğŸ—‘ï¸ åˆ é™¤ä¸´æ—¶ç›®å½•
      run: rm -rf ./../temp_dist

    - name: ğŸ“„ åˆ—å‡ºå½“å‰ç›®å½•æ–‡ä»¶
      run: ls -l

    - name: ğŸ“¥ æ·»åŠ æ‰€æœ‰æ›´æ”¹åˆ°Git
      run: git add .

    - name: ğŸ’¬ æäº¤æ›´æ”¹
      run: git commit -m "${{ github.event.head_commit.message }}"

    - name: ğŸš€ æ¨é€åˆ°main3åˆ†æ”¯
      run: git push origin main3
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
